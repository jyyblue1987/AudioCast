<script>
    var audioBuffer = null;
    var context = null;
    window.addEventListener('load', init, false);
    function init() {
        try {
            if(window.webkitAudioContext) {
                context = new window.webkitAudioContext();
            } else {
                context = new window.AudioContext();
            }
        } catch(e) {
            alert('Web Audio API is not supported in this browser');
        }
    }

    var host = window.location.hostname;
    if( host == "" )
        host = "localhost";

    console.log(host);

    function scrollToBottom()
    {
        setTimeout(function() {
            var list_container = document.getElementById("msg-container");
            list_container.scrollTop = list_container.scrollHeight;
            console.log(list_container.scrollTop);
        }, 100);
    }

    function decodeHandler(buffer) {
        console.log(data);
    }

    function WebSocketTest(port) {
        if ("WebSocket" in window) {
            // Let us open a web socket
            var ws = new WebSocket("ws://" + host + ":" + port);

            ws.onopen = function() {
                console.log("socket is connected")
            };

            ws.onmessage = function (event) {
                var data_type = typeof event.data;
                if ( data_type == "string" ) {
                    console.log(event.data);

                    return;
                }

                var reader = new FileReader();
                reader.readAsArrayBuffer(event.data);

                reader.onload = function(event) {
                    arrayBuffer = event.target.result;
                    context.decodeAudioData(arrayBuffer, decodeHandler, function(e) { console.log(e); });
                };
            };

            ws.onclose = function() {
                // websocket is closed.
                console.log("Connection is closed...");
                setTimeout(function() {
                   WebSocketTest(port);
               }, 1000);
            };

            ws.onerror = function(err) {
                console.error(err);
                ws.close()
            }

        } else {
            // The browser doesn't support WebSocket
            console.log("WebSocket NOT supported by your Browser!");
        }
    }

    init();
    setTimeout(function() {
           WebSocketTest(9001);
    }, 500);

</script>
