<script src="https://samirkumardas.github.io/jmuxer/jmuxer.min.js"></script>
<video id="player"></video>
<script>
    var host = window.location.hostname;
    if( host == "" )
        host = "localhost";

    console.log(host);

    var jmuxer = new JMuxer({
        node: 'player',
        mode: 'audio',
        debug: true
    });

    function parse(data) {
          var input = new Uint8Array(data)

          return {
                audio: input
          };
     }


    function WebSocketTest(port) {
        if ("WebSocket" in window) {
            // Let us open a web socket
            var ws = new WebSocket("ws://" + host + ":" + port);

            ws.binaryType = 'arraybuffer';
            ws.onopen = function() {
                console.log("socket is connected")
            };

            ws.addEventListener('message',function(event) {
                var data_type = typeof event.data
                if ( data_type == "string" ) {
                    console.log(event.data);
                    return;
                }

                var audio = new Uint8Array(event.data);
                jmuxer.feed({audio: audio});
            });

            ws.onclose = function() {
                // websocket is closed.
                console.log("Connection is closed...");
                setTimeout(function() {
                   WebSocketTest(port);
               }, 1000);
            };

            ws.onerror = function(err) {
                console.error(err);
                ws.close()
            }

        } else {
            // The browser doesn't support WebSocket
            console.log("WebSocket NOT supported by your Browser!");
        }
    }


    setTimeout(function() {
        WebSocketTest(9001);
    }, 500);

</script>
